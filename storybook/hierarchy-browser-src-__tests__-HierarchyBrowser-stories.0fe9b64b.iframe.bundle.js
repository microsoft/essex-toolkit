/*! For license information please see hierarchy-browser-src-__tests__-HierarchyBrowser-stories.0fe9b64b.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkessex_toolkit_stories=self.webpackChunkessex_toolkit_stories||[]).push([[130],{"../../.yarn/__virtual__/css-loader-virtual-348563e213/0/cache/css-loader-npm-6.8.1-30d84b4cf1-f20bb2a181.zip/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!../hierarchy-browser/src/__tests__/utils/components/Selections/Style.css":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/__virtual__/css-loader-virtual-348563e213/0/cache/css-loader-npm-6.8.1-30d84b4cf1-f20bb2a181.zip/node_modules/css-loader/dist/runtime/sourceMaps.js"),_yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("../../.yarn/__virtual__/css-loader-virtual-348563e213/0/cache/css-loader-npm-6.8.1-30d84b4cf1-f20bb2a181.zip/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_yarn_virtual_css_loader_virtual_348563e213_0_cache_css_loader_npm_6_8_1_30d84b4cf1_f20bb2a181_zip_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".hierarchy-choice-group .ms-ChoiceField {\n\tmargin: 10px;\n}\n","",{version:3,sources:["webpack://./../hierarchy-browser/src/__tests__/utils/components/Selections/Style.css"],names:[],mappings:"AAAA;CACC,YAAY;AACb",sourcesContent:[".hierarchy-choice-group .ms-ChoiceField {\n\tmargin: 10px;\n}\n"],sourceRoot:""}]);const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___},"../hierarchy-browser/src/__tests__/HierarchyBrowser.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{HierarchyBrowserAsync:()=>HierarchyBrowserAsync,HierarchyBrowserSynchronous:()=>HierarchyBrowserSynchronous,default:()=>HierarchyBrowser_stories});var jsx_runtime=__webpack_require__("../../.yarn/cache/react-npm-18.3.1-af38f3c1ae-261137d3f3.zip/node_modules/react/jsx-runtime.js"),react=__webpack_require__("../../.yarn/cache/react-npm-18.3.1-af38f3c1ae-261137d3f3.zip/node_modules/react/index.js"),styled_components_browser_cjs=__webpack_require__("../../.yarn/__virtual__/styled-components-virtual-1ce4ad2834/0/cache/styled-components-npm-6.1.11-a8d604297a-6813bba73a.zip/node_modules/styled-components/dist/styled-components.browser.cjs.js"),lib_commonjs=__webpack_require__("../../.yarn/__virtual__/@fluentui-react-virtual-de7476e3d6/0/cache/@fluentui-react-npm-8.118.9-93c5d7c0a7-1806e7182f.zip/node_modules/@fluentui/react/lib-commonjs/index.js");const EmptyEntityList=(0,react.memo)((function EmptyEntityList({filterProps,entities,isLoading}){return(0,jsx_runtime.jsx)(Container,{children:filterProps.state&&0===entities.length&&!isLoading?(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:"No unique items to show at this level. Toggle filter to view all items in this community."}):null})})),Container=styled_components_browser_cjs.default.div``;try{EmptyEntityList.displayName="EmptyEntityList",EmptyEntityList.__docgenInfo={description:"",displayName:"EmptyEntityList",props:{filterProps:{defaultValue:null,description:"",name:"filterProps",required:!0,type:{name:"IFilterProps"}},entities:{defaultValue:null,description:"",name:"entities",required:!0,type:{name:"IEntityDetail[]"}},isLoading:{defaultValue:null,description:"",name:"isLoading",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/EntityItem/EmptyEntityList.tsx#EmptyEntityList"]={docgenInfo:EmptyEntityList.__docgenInfo,name:"EmptyEntityList",path:"../hierarchy-browser/src/EntityItem/EmptyEntityList.tsx#EmptyEntityList"})}catch(__react_docgen_typescript_loader_error){}var react_infinite_scroller=__webpack_require__("../../.yarn/__virtual__/react-infinite-scroller-virtual-f7f0b597ce/0/cache/react-infinite-scroller-npm-1.2.6-e6206a2b69-d37d3dfc99.zip/node_modules/react-infinite-scroller/index.js"),react_infinite_scroller_default=__webpack_require__.n(react_infinite_scroller);const ScrollArea=(0,react.memo)((function ScrollArea({loadMore,hasMore,children}){const IS=react_infinite_scroller_default();return(0,jsx_runtime.jsx)(IS,{pageStart:0,loadMore,hasMore,useWindow:!1,loader:(0,jsx_runtime.jsx)(lib_commonjs.Spinner,{label:"Loading more records..."},"ei_spinner"),children})}));try{ScrollArea.displayName="ScrollArea",ScrollArea.__docgenInfo={description:"",displayName:"ScrollArea",props:{loadMore:{defaultValue:null,description:"",name:"loadMore",required:!0,type:{name:"(pageNumber?: number, params?: IEntityLoadParams) => Promise<IEntityDetail[]>"}},hasMore:{defaultValue:null,description:"",name:"hasMore",required:!0,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/ScollArea/ScrollArea.tsx#ScrollArea"]={docgenInfo:ScrollArea.__docgenInfo,name:"ScrollArea",path:"../hierarchy-browser/src/ScollArea/ScrollArea.tsx#ScrollArea"})}catch(__react_docgen_typescript_loader_error){}var ENTITY_TYPE,useThematic=__webpack_require__("../../.yarn/__virtual__/@thematic-react-virtual-1d715ad545/0/cache/@thematic-react-npm-2.1.9-5021c00aed-19e6347a18.zip/node_modules/@thematic/react/dist/useThematic.js");function useContainerStyle(isOpen){const theme=(0,useThematic.J)();return(0,react.useMemo)((()=>({height:isOpen?250:0,width:isOpen?"100%":"0px",border:`1px solid ${theme.application().faint().hex()}`,flex:isOpen?1:"revert",WebkitFlex:isOpen?1:"revert"})),[isOpen,theme])}function useEntitiesLoadedHandler(initialLoadingState){const[isLoading,setLoading]=(0,react.useState)(initialLoadingState),[entities,setEntities]=(0,react.useState)([]),[entitiesLoaded,setEntitiesLoaded]=(0,react.useState)(!1),clearEntities=(0,react.useCallback)((loading=>{setEntitiesLoaded(!1),setEntities([])}),[setEntitiesLoaded,setEntities]),handleEntitiesLoaded=(0,react.useCallback)(((entities,error)=>{error&&console.error(error),setEntities(entities),setLoading(!1),setEntitiesLoaded(!0)}),[setEntities,setLoading,setEntitiesLoaded]);return[entities,handleEntitiesLoaded,clearEntities,setLoading,isLoading,entitiesLoaded]}function _define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}!function(ENTITY_TYPE){ENTITY_TYPE.ENTITY="entity",ENTITY_TYPE.NEIGHBOR="neighbor"}(ENTITY_TYPE||(ENTITY_TYPE={}));class EntityDataProvider{clearDisplay(){this._displayEntities=[]}clearFilteredMap(){this._filteredIds.clear()}clear(){this.clearDisplay(),this.clearFilteredMap(),this.clearEntities()}set size(s){this._size=void 0===s||-1===s?void 0:s}get size(){return this._size}clearEntities(){this._entities=[]}get entities(){return this._entities}addToEntitiesArray(entities){this._entities=this._entities.concat(entities)}get displayEntities(){return this._displayEntities}set displayEntities(display){this._displayEntities=display}set loadEntitiesFromProvider(value){this._loadEntitiesFromProvider=value}getFilterEntitiesFromCache(){return this._entities.filter((e=>this._filteredIds.has(e.id)))}async loadItemsAsync(params){if(this._loadEntitiesFromProvider){const nextNodes=await this._loadEntitiesFromProvider(params,this._entityType);if(nextNodes?.error||nextNodes?.data){if(!nextNodes.error&&nextNodes.data){return nextNodes.data.filter((d=>d))}throw nextNodes.error}}throw new Error("missing load entities callback")}async loadAndSaveItems(params){const filtered=params.filtered,data=await this.loadItemsAsync(params);return data&&(filtered?this._filteredIds=new Set(data.map((d=>d.id))):this.addToEntitiesArray(data)),data}async loadItems(params,maxSize){const{count,filtered,offset}=params,totalLength=count+offset,size=this._size||maxSize;if(filtered)if(this._filteredIds.size>0&&this._filteredIds.size<=totalLength&&this._entities.length>0){const filterEntities=this.getFilterEntitiesFromCache();this.displayEntities=filterEntities}else{const items=await this.loadAndSaveItems(params);items&&(this.displayEntities=items)}else this._entities.length<totalLength&&size&&this._entities.length<size&&await this.loadAndSaveItems(params),this.displayEntities=this._entities;return[...this._displayEntities].slice(params.offset,params.count+params.offset)}async getCommunityMembers(params,maxSize){try{maxSize&&(this._size=maxSize);return await this.loadItems(params,maxSize)||[]}catch(e){throw Error(`Error: There is an issue loading entities for level ${params.level}, community ${params.communityId}`)}}constructor(entityType,size,handleLoading){_define_property(this,"_entities",[]),_define_property(this,"_displayEntities",[]),_define_property(this,"_filteredIds",new Set),_define_property(this,"_entityType",void 0),_define_property(this,"_size",void 0),_define_property(this,"_loadEntitiesFromProvider",void 0),this._size=-1===size?void 0:size,this._entityType=entityType,this._loadEntitiesFromProvider=handleLoading}}function CommunityDataProvider_define_property(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}const DEFAULT_LOAD_COUNT=100;class CommunityDataProvider{useEntityHandler(loadEntitiesCallback){return(params,type)=>loadEntitiesCallback(params,this._neighborCommunities,type)}updateCommunityData(communityData){this._community=communityData.communityId,this._size=communityData.entityIds?.length||communityData.size,this._neighborSize=communityData.neighborSize||-1}updateEntityLoader(loadEntitiesCallback){const callback=this.useEntityHandler(loadEntitiesCallback);this._entityProvider.size=this._size,this._entityProvider.loadEntitiesFromProvider=callback,this._neighborEntitiesProvider.loadEntitiesFromProvider=callback}setFilterEntities(filterEntities){this._filterEntitiesFlag=filterEntities,this._entityProvider.clearDisplay()}clearNeighborEdges(){this._neighborEntitiesProvider.clear()}get loadNeighborsCallback(){return this._loadNeighborsCallback}set loadNeighborsCallback(cb){this._loadNeighborsCallback=cb}set level(level){this._level=level}get level(){return this._level}set neighborSize(size){this._neighborSize=size}get neighborSize(){return this._neighborSize}get size(){return this._size}get communityId(){return this._community}addToNeighborCommunitiesArray(communities){this._neighborCommunities=this._neighborCommunities.concat(communities)}async loadNeighborsAsync(params){if(this._neighborCommunities.length>0&&0===params.offset)return this._neighborCommunities;if(this._loadNeighborsCallback){const nextNeighbors=await this._loadNeighborsCallback(params,this._community);if(!nextNeighbors.error&&nextNeighbors.data)return this.addToNeighborCommunitiesArray(nextNeighbors.data),nextNeighbors.data;throw nextNeighbors.error}}async getAdjacentCommunities(offset,pageSize){const loadCount=pageSize||DEFAULT_LOAD_COUNT,params={communityId:this._community,level:this._level,count:loadCount,offset,filtered:this._filterEntitiesFlag};try{return this.loadNeighborsAsync(params).then((res=>res||[]))}catch(err){throw console.warn(err),Error(`Error: There is an issue loading neighbors for level ${this._level}, community ${this._community}`)}}async getCommunityMembers(offset,pageSize,community,filtered,entityType,max){const loadCount=pageSize||DEFAULT_LOAD_COUNT,communityId=void 0!==community?community:this._community,filteredFlag=void 0!==filtered?filtered:this._filterEntitiesFlag,params={communityId,level:this._level,count:loadCount,offset,filtered:filteredFlag};let provider=this._entityProvider;return entityType&&entityType===ENTITY_TYPE.NEIGHBOR&&(provider=this._neighborEntitiesProvider),await provider.getCommunityMembers(params,max||this._size)}constructor(communityData,loadEntitiesCallback,level){CommunityDataProvider_define_property(this,"_community",""),CommunityDataProvider_define_property(this,"_neighborSize",-1),CommunityDataProvider_define_property(this,"_neighborCommunities",[]),CommunityDataProvider_define_property(this,"_size",0),CommunityDataProvider_define_property(this,"_level",0),CommunityDataProvider_define_property(this,"_filterEntitiesFlag",!1),CommunityDataProvider_define_property(this,"_loadNeighborsCallback",void 0),CommunityDataProvider_define_property(this,"_neighborEntitiesProvider",void 0),CommunityDataProvider_define_property(this,"_entityProvider",void 0),this.updateCommunityData(communityData),this._level=level;const callback=this.useEntityHandler(loadEntitiesCallback);this._entityProvider=new EntityDataProvider(ENTITY_TYPE.ENTITY,this._size,callback),this._neighborEntitiesProvider=new EntityDataProvider(ENTITY_TYPE.NEIGHBOR,this._neighborSize,callback),this.setFilterEntities(!1)}}function useLoadInitialEntitiesHandler(handleEntitiesLoaded,isEntitiesLoading,dataProvider){return(0,react.useCallback)(((page,params)=>{void 0!==dataProvider?isEntitiesLoading||dataProvider.getCommunityMembers(0,DEFAULT_LOAD_COUNT,params?.communityId,params?.filtered,params?.type,params?.max).then((data=>handleEntitiesLoaded(data,void 0))).catch((err=>{console.warn(`error loading initial entities: ${err}`),handleEntitiesLoaded([],err)})):console.warn("No CommunityDataProvider loaded")}),[dataProvider,handleEntitiesLoaded,isEntitiesLoading])}function useLoadMoreEntitiesHandler(entities,moreToLoad,setMoreToLoad,handleEntitiesLoaded,dataProvider,isLoading){const getEntities=(0,react.useCallback)((()=>Promise.resolve(entities)),[entities]);return(0,react.useCallback)(((pageNumber,params)=>{const initialOffset=entities?entities.length:0,offset=void 0!==params?.offset?params.offset:initialOffset,loadCount=params?.loadCount?params.loadCount:DEFAULT_LOAD_COUNT;return moreToLoad?isLoading?void 0:dataProvider?dataProvider.getCommunityMembers(offset,loadCount,params?.communityId,params?.filtered,params?.type,params?.max).then((nodes=>{if(nodes&&nodes.length>0){const all=[...entities||[],...nodes];return nodes.length<DEFAULT_LOAD_COUNT&&setMoreToLoad(!1),handleEntitiesLoaded(all,void 0),all}return setMoreToLoad(!1),[]})).catch((err=>(console.warn("error",err),setMoreToLoad(!1),handleEntitiesLoaded([],err),[]))):void console.warn("error: dataProvider was not found. Unable to load entities"):getEntities()}),[dataProvider,moreToLoad,setMoreToLoad,handleEntitiesLoaded,entities,getEntities,isLoading])}function useCommunityData(dataProvider,isOpenProp,maxLevel){const[filterEntities,setFilterEntities]=(0,react.useState)(!1),[moreToLoad,setMoreToLoad]=(0,react.useState)(!0),[entities,handleEntitiesLoaded,clearEntities,setLoading,isLoading,entitiesLoaded]=useEntitiesLoadedHandler(!1),[isOpen,setIsOpen]=(0,react.useState)(isOpenProp),loadMore=useLoadMoreEntitiesHandler(entities,moreToLoad,(0,react.useCallback)((state=>{setMoreToLoad(state)}),[setMoreToLoad]),handleEntitiesLoaded,dataProvider,isLoading);!function useLoadEntitiesOnMountEffect(loadInitialEntities,isOpen,entitiesLoaded,size=0){(0,react.useEffect)((()=>{isOpen&&!entitiesLoaded&&size>0&&loadInitialEntities()}),[entitiesLoaded,isOpen,loadInitialEntities,size])}(useLoadInitialEntitiesHandler(handleEntitiesLoaded,isLoading,dataProvider),isOpen,entitiesLoaded,dataProvider.size);const toggleOpen=(0,react.useCallback)((()=>{setIsOpen(!isOpen)}),[isOpen,setIsOpen]),toggleFilter=(0,react.useCallback)((()=>{clearEntities(!0),setMoreToLoad(!0),setFilterEntities(!filterEntities),setLoading(!1),dataProvider.setFilterEntities(!filterEntities)}),[filterEntities,setFilterEntities,clearEntities,dataProvider,setLoading]),filterProps=(0,react.useMemo)((()=>({disabled:maxLevel===dataProvider.level,state:filterEntities,toggleFilter})),[maxLevel,toggleFilter,filterEntities,dataProvider]);return[entities,isLoading,loadMore,moreToLoad,isOpen??!1,toggleOpen,filterProps]}function useDimensions(ref){const[dimensions,setDimensions]=(0,react.useState)();return(0,react.useEffect)((()=>{if(ref?.current){const rect=ref.current.getBoundingClientRect();let dims={width:Math.floor(rect.width),height:Math.floor(rect.height)};setDimensions(dims);const observer=new ResizeObserver((entries=>{const entry=entries[0];if(entry){const newDims={width:Math.floor(entry.contentRect.width),height:Math.floor(entry.contentRect.height)};newDims.width===dims.width&&newDims.height===dims.height||(dims=newDims,setDimensions(newDims))}}));return observer.observe(ref.current),()=>{observer.disconnect()}}}),[ref]),dimensions}const variants_mediumPlus="mediumPlus",variants_large="large",headerLabel=variants_large,subHeaderLabel=variants_mediumPlus,tableItems="medium",textStyle={root:{marginLeft:10}},NO_STYLE=Object.freeze({}),NO_ICON_STYLE=Object.freeze({});function useTableStyles(styles){const headerStyle=styles?.header??NO_STYLE,subheaderStyle=styles?.subheader??NO_STYLE,rootStyle=styles?.root??NO_STYLE,headerVariant=styles?.headerText??headerLabel,subheaderVariant=styles?.subHeaderText??subHeaderLabel,itemVariant=styles?.tableItemsText??tableItems;return[headerVariant,subheaderVariant,headerStyle,subheaderStyle,rootStyle,styles?.tableItems??{},itemVariant]}const Bar=(0,react.memo)((function Bar({value,scale,color,height,width}){const size=(0,react.useMemo)((()=>scale(value)),[scale,value]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(SvgElement,{width,height,children:(0,jsx_runtime.jsx)("rect",{width:size||10,height,x:width-(size||0),fill:color,rx:1,opacity:.5})})})})),SvgElement=styled_components_browser_cjs.default.svg`
	width: ${({width})=>width};
	height: ${({height})=>height};
	position: absolute;
	top: 0;
	left: 0;
`;try{Bar.displayName="Bar",Bar.__docgenInfo={description:"",displayName:"Bar",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"number"}},scale:{defaultValue:null,description:"",name:"scale",required:!0,type:{name:"ScaleLinear<number, number, never>"}},color:{defaultValue:null,description:"",name:"color",required:!0,type:{name:"string"}},height:{defaultValue:null,description:"",name:"height",required:!0,type:{name:"string | number"}},width:{defaultValue:null,description:"",name:"width",required:!0,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/NeighborList/Bar.tsx#Bar"]={docgenInfo:Bar.__docgenInfo,name:"Bar",path:"../hierarchy-browser/src/NeighborList/Bar.tsx#Bar"})}catch(__react_docgen_typescript_loader_error){}var enums=__webpack_require__("../../.yarn/__virtual__/@thematic-core-virtual-bc53be5abe/0/cache/@thematic-core-npm-4.0.7-c127a4a6f7-258e1c254c.zip/node_modules/@thematic/core/dist/types/enums.js"),linear=__webpack_require__("../../.yarn/cache/d3-scale-npm-4.0.2-d17a53447b-e2dc424358.zip/node_modules/d3-scale/src/linear.js");function useRowElements(theme,selectedEdge,edges,dimensions){const[maxConnections,maxSize]=function useMaxEdges(edges){return(0,react.useMemo)((()=>edges&&edges.length>0?edges.reduce(((prev,current)=>(current.connections>prev[0]&&(prev[0]=current.connections),current.size>prev[1]&&(prev[1]=current.size),prev)),[0,0]):[Number.NaN,Number.NaN]),[edges])}(edges),barColor=(0,react.useMemo)((()=>theme.rect({selectionState:enums.fP.Selected}).fill().hex()),[theme]),[connScale,sizeScale]=(0,react.useMemo)((()=>{const width=dimensions?dimensions.width:10;return[(0,linear.Z)().domain([0,maxConnections||10]).range([0,width]),(0,linear.Z)().domain([0,maxSize||10]).range([0,width])]}),[maxSize,maxConnections,dimensions]);return[(0,react.useCallback)(((edge,rowIndex)=>{let backgroundColor=rowIndex%2==0?theme.application().faint().hex():"transparent";if(selectedEdge&&edge.communityId===selectedEdge.communityId){const alpha=theme.config.dark?.4:.2,[r,g,b,a]=theme.rect({selectionState:enums.fP.Selected}).fill().rgbav(alpha);backgroundColor=`rgba(${255*r}, ${255*g}, ${255*b}, ${a})`}return{backgroundColor}}),[theme,selectedEdge]),barColor,connScale,sizeScale]}const SUBHEADERS=["community","connections","members"],CommunityEdgeList=(0,react.memo)((function CommunityEdgeList({edges,selectedEdge,onEdgeClick,clearCurrentSelection,styles}){const[headerVariant,subheaderVariant,headerStyle,subheaderStyle,rootStyle,itemStyle,itemVariant]=useTableStyles(styles),theme=(0,useThematic.J)(),handleEdgeClick=(0,react.useCallback)((edge=>{clearCurrentSelection().then((()=>{edge&&selectedEdge&&edge.communityId===selectedEdge.communityId?onEdgeClick(void 0):onEdgeClick(edge)}))}),[onEdgeClick,selectedEdge,clearCurrentSelection]),sortedEdges=function useSortedNeighbors(edges){return(0,react.useMemo)((()=>{if(edges&&edges.length>0)return edges.sort(((a,b)=>b.connections-a.connections))}),[edges])}(edges),ref=(0,react.useRef)(null),connRef=(0,react.useRef)(null),memberDimensions=useDimensions(ref),connectionDimensions=useDimensions(connRef),[getBackgroundStyle,barColor,connScale,sizeScale]=useRowElements(theme,selectedEdge,edges,memberDimensions);return sortedEdges?(0,jsx_runtime.jsxs)(Table,{className:"tableItems-root",style:rootStyle,children:[(0,jsx_runtime.jsx)(TableHead,{children:(0,jsx_runtime.jsx)(TableRow,{children:(0,jsx_runtime.jsx)(TableHeader,{colSpan:3,className:"tableItems-header",style:headerStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:headerVariant,children:(0,jsx_runtime.jsx)(Bold,{children:"Neighboring Communities"})})})})}),(0,jsx_runtime.jsxs)(TableBody,{children:[(0,jsx_runtime.jsx)(TableRow,{children:SUBHEADERS.map(((header,index)=>(0,jsx_runtime.jsx)(TableHeader,{className:"tableItems-subheader",style:subheaderStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:subheaderVariant,styles:textStyle,children:(0,jsx_runtime.jsx)(Bold,{children:header})})},`subheader-${index}`)))}),sortedEdges.map(((edge,i)=>{const onEdgeClick=()=>handleEdgeClick(edge);return(0,jsx_runtime.jsxs)(TableRow,{children:[(0,jsx_runtime.jsx)(TableCell,{style:{...getBackgroundStyle(edge,i),textAlign:"center",...itemStyle},onClick:onEdgeClick,children:(0,jsx_runtime.jsx)(TableMaxHeight,{children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:itemVariant,styles:textStyle,children:edge.communityId})})}),(0,jsx_runtime.jsx)(TableCell,{style:{...itemStyle,...getBackgroundStyle(edge,i)},onClick:onEdgeClick,ref:connRef,children:(0,jsx_runtime.jsx)(TableMaxHeight,{children:(0,jsx_runtime.jsxs)(AbsoluteDiv,{children:[(0,jsx_runtime.jsx)(TextContainer,{children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:itemVariant,styles:textStyle,children:edge.connections})}),connectionDimensions?.width?(0,jsx_runtime.jsx)(Bar,{value:edge.connections,width:connectionDimensions.width,height:connectionDimensions?.height||15,color:barColor,scale:connScale}):null]})})},"neighbor-community-0"),(0,jsx_runtime.jsx)(TableCell,{style:{...itemStyle,...getBackgroundStyle(edge,i)},onClick:onEdgeClick,ref,children:(0,jsx_runtime.jsx)(TableMaxHeight,{children:(0,jsx_runtime.jsxs)(AbsoluteDiv,{children:[(0,jsx_runtime.jsx)(TextContainer,{children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:itemVariant,styles:textStyle,children:edge.size})}),memberDimensions?.width?(0,jsx_runtime.jsx)(Bar,{value:edge.size,width:memberDimensions.width,height:memberDimensions?.height||15,color:barColor,scale:sizeScale}):null]})})},"neighbor-community-1")]},`edge-${i}`)}))]})]}):null}));CommunityEdgeList.displayName="CommunityEdgeList";const NeighborList_CommunityEdgeList=CommunityEdgeList,Table=styled_components_browser_cjs.default.table`
	width: 100%;
	border-collapse: collapse;
`,TableHead=styled_components_browser_cjs.default.thead``,TableRow=styled_components_browser_cjs.default.tr``,TableBody=styled_components_browser_cjs.default.tbody``,TableMaxHeight=styled_components_browser_cjs.default.div`
	height: 15px;
`,Bold=styled_components_browser_cjs.default.div`
	font-weight: bold;
`,TableHeader=styled_components_browser_cjs.default.td`
	font-weight: bold;
	width: 1px;
	white-space: nowrap;
	text-align: center;
`,TableCell=styled_components_browser_cjs.default.td`
	white-space: nowrap;
	width: 1px;
	cursor: pointer;
	text-align: end;
	position: relative;
	min-height: 10px;
`,TextContainer=styled_components_browser_cjs.default.div`
	z-index: 2;
	top: 0px;
	right: 5px;
	position: absolute;
`,AbsoluteDiv=styled_components_browser_cjs.default.div`
	top: 0;
`;try{CommunityEdgeList.displayName="CommunityEdgeList",CommunityEdgeList.__docgenInfo={description:"",displayName:"CommunityEdgeList",props:{edges:{defaultValue:null,description:"",name:"edges",required:!1,type:{name:"INeighborCommunityDetail[]"}},onEdgeClick:{defaultValue:null,description:"",name:"onEdgeClick",required:!0,type:{name:"(edge?: INeighborCommunityDetail) => void"}},clearCurrentSelection:{defaultValue:null,description:"",name:"clearCurrentSelection",required:!0,type:{name:"() => Promise<void>"}},selectedEdge:{defaultValue:null,description:"",name:"selectedEdge",required:!1,type:{name:"INeighborCommunityDetail"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"ITableSettings"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/NeighborList/CommunityEdgeList.tsx#CommunityEdgeList"]={docgenInfo:CommunityEdgeList.__docgenInfo,name:"CommunityEdgeList",path:"../hierarchy-browser/src/NeighborList/CommunityEdgeList.tsx#CommunityEdgeList"})}catch(__react_docgen_typescript_loader_error){}const EntityItem_NO_STYLE=Object.freeze({}),EntityItem=({item,attrs,index,selected,styles,onEntityClick})=>{const rowStyle=function useRowStyle(index,selected){const theme=(0,useThematic.J)(),backgroundColor=(0,react.useMemo)((()=>{let backgroundColor=index%2==0?theme.application().faint().hex():"transparent";if(selected){const alpha=theme.config.dark?.4:.2,[r,g,b,a]=theme.rect({selectionState:enums.fP.Selected}).fill().rgbav(alpha);backgroundColor=`rgba(${255*r}, ${255*g}, ${255*b}, ${a})`}return backgroundColor}),[selected,theme,index]);return(0,react.useMemo)((()=>({backgroundColor})),[backgroundColor])}(index,selected),itemStyle=styles?.tableItems??EntityItem_NO_STYLE,itemVariant=styles?.tableItemsText??tableItems,onTableItemClick=(0,react.useCallback)((()=>onEntityClick(item.id)),[onEntityClick,item]);return(0,jsx_runtime.jsxs)(EntityItem_TableRow,{style:rowStyle,onClick:onTableItemClick,children:[(0,jsx_runtime.jsx)(TableItem,{className:"tableItem",style:itemStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:itemVariant,styles:textStyle,children:item.id})}),attrs?attrs.map(((attr,i)=>(0,jsx_runtime.jsxs)(TableItem,{className:"tableItem",style:itemStyle,children:[item.attrs?.[attr]?(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:itemVariant,styles:textStyle,children:item.attrs[attr].toLocaleString()}):""," "]},`attr${i}`))):null]},`e${index}`)},EntityItem_TableRow=styled_components_browser_cjs.default.tr``,TableItem=styled_components_browser_cjs.default.td`
	cursor: pointer;
`;try{EntityItem.displayName="EntityItem",EntityItem.__docgenInfo={description:"",displayName:"EntityItem",props:{item:{defaultValue:null,description:"",name:"item",required:!0,type:{name:"IEntityDetail"}},attrs:{defaultValue:null,description:"",name:"attrs",required:!0,type:{name:"string[]"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},selected:{defaultValue:null,description:"",name:"selected",required:!1,type:{name:"boolean"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"ITableSettings"}},onEntityClick:{defaultValue:null,description:"",name:"onEntityClick",required:!0,type:{name:"(entiyId: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/EntityItem/EntityItem.tsx#EntityItem"]={docgenInfo:EntityItem.__docgenInfo,name:"EntityItem",path:"../hierarchy-browser/src/EntityItem/EntityItem.tsx#EntityItem"})}catch(__react_docgen_typescript_loader_error){}const CommunityTable=(0,react.memo)((function CommunityTable({entities,minimize,styles,communityId,visibleColumns,selections,onSelectionChange}){const isSelected=(0,react.useCallback)((entity=>selections?.includes(entity.id)),[selections]),attrKeys=(0,react.useMemo)((()=>visibleColumns||(minimize||!entities[0].attrs?[]:Object.keys(entities[0].attrs))),[entities,minimize,visibleColumns]),[headerVariant,subheaderVariant,headerStyle,subheaderStyle,rootStyle]=useTableStyles(styles),headerText=communityId?`${communityId} Community Membership`:"Community Membership";return(0,jsx_runtime.jsxs)(CommunityTable_Table,{className:"tableItems-root",style:rootStyle,children:[(0,jsx_runtime.jsx)(CommunityTable_TableHeader,{children:(0,jsx_runtime.jsx)(CommunityTable_TableRow,{children:(0,jsx_runtime.jsx)(TableHeaderRow,{colSpan:attrKeys.length+1,className:"tableItems-header",style:headerStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:headerVariant,children:(0,jsx_runtime.jsx)(CommunityTable_Bold,{children:headerText})})})})}),(0,jsx_runtime.jsx)(THeader,{children:(0,jsx_runtime.jsx)(CommunityTable_TableRow,{children:["id",...attrKeys].map(((key,i)=>(0,jsx_runtime.jsx)(HeaderCell,{className:"tableItems-subheader",style:subheaderStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:subheaderVariant,styles:textStyle,children:(0,jsx_runtime.jsx)(CommunityTable_Bold,{children:key})})},`table-header-${i}`)))})}),(0,jsx_runtime.jsx)(CommunityTable_TableBody,{children:entities.map(((entity,i)=>(0,jsx_runtime.jsx)(EntityItem,{item:entity,attrs:attrKeys,index:i,styles,selected:isSelected(entity),onEntityClick:onSelectionChange},`entity_${i}`)))})]})}));CommunityTable.displayName="CommunityTableProps";const THeader=styled_components_browser_cjs.default.thead`
	font-weight: bold;
`,CommunityTable_TableRow=styled_components_browser_cjs.default.tr``,CommunityTable_TableHeader=styled_components_browser_cjs.default.thead``,CommunityTable_TableBody=styled_components_browser_cjs.default.tbody``,CommunityTable_Bold=styled_components_browser_cjs.default.div`
	font-weight: bold;
`,CommunityTable_Table=styled_components_browser_cjs.default.table`
	width: 100%;
	border-collapse: collapse;
`,HeaderCell=styled_components_browser_cjs.default.th`
	width: 16%;
	width: 1px;
	white-space: nowrap;
`,TableHeaderRow=styled_components_browser_cjs.default.th`
	font-weight: bold;
	width: 1px;
	white-space: nowrap;
	text-align: center;
`;try{CommunityTable.displayName="CommunityTableProps",CommunityTable.__docgenInfo={description:"",displayName:"CommunityTableProps",props:{entities:{defaultValue:null,description:"",name:"entities",required:!0,type:{name:"IEntityDetail[]"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"ITableSettings"}},communityId:{defaultValue:null,description:"",name:"communityId",required:!1,type:{name:"string"}},visibleColumns:{defaultValue:null,description:"",name:"visibleColumns",required:!1,type:{name:"string[]"}},minimize:{defaultValue:null,description:"",name:"minimize",required:!1,type:{name:"boolean"}},selections:{defaultValue:null,description:"",name:"selections",required:!1,type:{name:"string[]"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!0,type:{name:"(id: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/CommunityCard/CommunityTable.tsx#CommunityTableProps"]={docgenInfo:CommunityTableProps.__docgenInfo,name:"CommunityTableProps",path:"../hierarchy-browser/src/CommunityCard/CommunityTable.tsx#CommunityTableProps"})}catch(__react_docgen_typescript_loader_error){}const iconButtonStyles={root:{maxHeight:"15px",maxWidth:"15px"}},TableExpander=(0,react.memo)((function TableExpander({isOpen,handleButtonClick,styles}){const iconName=(0,react.useMemo)((()=>isOpen?"DoubleChevronRight12":"DoubleChevronLeft12"),[isOpen]),buttonStyle=styles??iconButtonStyles,handleClick=(0,react.useCallback)((()=>{handleButtonClick(!isOpen)}),[handleButtonClick,isOpen]);return(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(Header,{children:(0,jsx_runtime.jsx)(lib_commonjs.IconButton,{styles:buttonStyle,iconProps:{iconName},text:"Panel Resize",onClick:handleClick})})})})),Header=styled_components_browser_cjs.default.div`
	display: flex;
	justify-content: center;
	align-items: center;
`;try{TableExpander.displayName="TableExpander",TableExpander.__docgenInfo={description:"",displayName:"TableExpander",props:{isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},handleButtonClick:{defaultValue:null,description:"",name:"handleButtonClick",required:!0,type:{name:"(state: boolean) => void"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"IButtonStyles"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/CommunityCard/TableExpander.tsx#TableExpander"]={docgenInfo:TableExpander.__docgenInfo,name:"TableExpander",path:"../hierarchy-browser/src/CommunityCard/TableExpander.tsx#TableExpander"})}catch(__react_docgen_typescript_loader_error){}function useAdjacentCommunityData(dataProvider,isOpen,refresh){const[communities,isLoading,communitiesLoaded,handleCommunitiesLoaded]=function useNeighborsLoadedHandler(){const[isLoading,setLoading]=(0,react.useState)(!1),[communities,setCommunities]=(0,react.useState)([]),[communitiesLoaded,setcommunitiesLoaded]=(0,react.useState)(!1),clearCommunities=(0,react.useCallback)((loading=>{setcommunitiesLoaded(!1),setCommunities([]),setLoading(loading)}),[setcommunitiesLoaded,setLoading]),handleCommunitiesLoaded=(0,react.useCallback)(((communities,error)=>{error&&console.error(error),communities&&communities.length>0&&(setCommunities(communities),setLoading(!1),setcommunitiesLoaded(!0))}),[setCommunities,setLoading,setcommunitiesLoaded]);return[communities,isLoading,communitiesLoaded,handleCommunitiesLoaded,clearCommunities]}(),loadInitialCommunities=function useLoadInitialCommunities(handleCommunitiesLoaded,dataProvider){return(0,react.useCallback)((()=>{dataProvider.getAdjacentCommunities(0,DEFAULT_LOAD_COUNT).then((data=>handleCommunitiesLoaded(data||[],void 0))).catch((err=>handleCommunitiesLoaded([],err)))}),[dataProvider,handleCommunitiesLoaded])}(handleCommunitiesLoaded,dataProvider);return function useLoadCommunitiesOnMountEffect(loadInitialEntities,isOpen,entitiesLoaded,refresh){(0,react.useEffect)((()=>{isOpen&&!entitiesLoaded&&loadInitialEntities()}),[refresh,isOpen,entitiesLoaded,loadInitialEntities])}(loadInitialCommunities,isOpen,communitiesLoaded,refresh),[communities,isLoading]}const AdjacentCommunities=function AdjacentCommunities({dataProvider,isOpen,styles,visibleColumns,minimizeColumns,refresh,selections,onSelectionChange}){const colorStyle=function useThemesAccentStyle(isOpen){const theme=(0,useThematic.J)();return(0,react.useMemo)((()=>({background:theme.application().faint().hex(),borderColor:theme.application().lowContrast().hex(),visible:isOpen?"visible":"hidden",width:isOpen?"15px":0})),[theme,isOpen])}(isOpen),{edgeContentStyle,edgeEntitiesContentStyle,edgeEntitiesExpanderClick,edgeExpanderClick,edgeListOpen,edgeEntitiesOpen}=function useExpandedPanel({isOpen}){const[edgeListOpen,setEdgeListOpen]=(0,react.useState)(!0),[edgeEntitiesOpen,setEdgeEntitiesOpen]=(0,react.useState)(!0),edgeContentStyle=useContainerStyle(isOpen&&edgeListOpen),edgeEntitiesExpanderClick=(0,react.useCallback)((newState=>{setEdgeEntitiesOpen(newState)}),[setEdgeEntitiesOpen]),edgeExpanderClick=(0,react.useCallback)((newState=>{setEdgeListOpen(newState)}),[setEdgeListOpen]);return{edgeContentStyle,edgeEntitiesContentStyle:useContainerStyle(isOpen&&edgeEntitiesOpen),edgeEntitiesExpanderClick,edgeExpanderClick,edgeListOpen,edgeEntitiesOpen}}({isOpen}),[setEdgeSelection,loadMoreEntities,moreEntitiesToLoad,edgeEntities,selectedCommunityEdge,clearCurrentSelection]=function useEdgeSelection(dataProvider){const[selectedCommunityEdge,setSelectedCommunityEdge]=(0,react.useState)(),[moreEntitiesToLoad,setMoreEntitiesToLoad]=(0,react.useState)(!0),[entities,handleEntitiesLoaded,clearEntities,setLoading,isLoading]=useEntitiesLoadedHandler(!1),loadMoreEntities=useLoadMoreEntitiesHandler(entities,moreEntitiesToLoad,setMoreEntitiesToLoad,handleEntitiesLoaded,dataProvider),loadInitialEntities=useLoadInitialEntitiesHandler(handleEntitiesLoaded,isLoading,dataProvider),loadMoreOnScroll=(0,react.useCallback)((async(pageNumber,params)=>{if(selectedCommunityEdge){const defaultParams={communityId:selectedCommunityEdge.communityId,filtered:!1,type:ENTITY_TYPE.NEIGHBOR};return await loadMoreEntities(void 0,params||defaultParams)||[]}return[]}),[loadMoreEntities,selectedCommunityEdge]),clearCurrentSelection=(0,react.useCallback)((async()=>{await Promise.resolve(),setMoreEntitiesToLoad(!0),clearEntities(!0),setLoading(!1),dataProvider?.clearNeighborEdges()}),[clearEntities,setMoreEntitiesToLoad,setLoading,dataProvider]);return[(0,react.useCallback)((edge=>{if(setSelectedCommunityEdge(edge),edge){const params={offset:0,communityId:edge.communityId,filtered:!1,type:ENTITY_TYPE.NEIGHBOR,max:edge.size};dataProvider?.clearNeighborEdges(),loadInitialEntities(void 0,params)}}),[setSelectedCommunityEdge,loadInitialEntities,dataProvider]),loadMoreOnScroll,moreEntitiesToLoad,entities,selectedCommunityEdge,clearCurrentSelection]}(dataProvider),[adjacentCommunities,isAdjacentEntitiesLoading]=useAdjacentCommunityData(dataProvider,isOpen,refresh);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[adjacentCommunities&&adjacentCommunities.length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Spacer,{style:colorStyle,className:"neighbor-expander-button",children:isOpen?(0,jsx_runtime.jsx)(TableExpander,{isOpen:edgeListOpen,handleButtonClick:edgeExpanderClick,styles:styles?.neighborExpandButton}):null}),(0,jsx_runtime.jsx)(Content,{style:edgeContentStyle,children:(0,jsx_runtime.jsx)(NeighborList_CommunityEdgeList,{edges:adjacentCommunities,selectedEdge:selectedCommunityEdge,onEdgeClick:setEdgeSelection,clearCurrentSelection,isOpen:edgeListOpen,styles})})]}):null,isAdjacentEntitiesLoading||edgeEntities?.length>0?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Spacer,{style:colorStyle,className:"neighbor-expander-button",children:isOpen?(0,jsx_runtime.jsx)(TableExpander,{isOpen:edgeEntitiesOpen,handleButtonClick:edgeEntitiesExpanderClick,styles:styles?.neighborExpandButton}):null}),(0,jsx_runtime.jsxs)(Content,{style:edgeEntitiesContentStyle,children:[edgeEntities?.length>0&&edgeEntitiesOpen?(0,jsx_runtime.jsx)(ScrollArea,{loadMore:loadMoreEntities,hasMore:moreEntitiesToLoad,children:(0,jsx_runtime.jsx)(CommunityTable,{entities:edgeEntities,communityId:selectedCommunityEdge?.communityId,visibleColumns,styles,minimize:minimizeColumns,selections,onSelectionChange})}):null,isAdjacentEntitiesLoading?(0,jsx_runtime.jsx)(lib_commonjs.Spinner,{label:"Fetching entity data..."}):null]})]}):null]})},Content=styled_components_browser_cjs.default.div`
	overflow-y: auto;
	transition: height 0.2s;
`,Spacer=styled_components_browser_cjs.default.div`
	border-style: solid;
	border-width: 0px 0.5px 0px 0.5px;
	align-self: center;
	overflow: hidden;
`;try{AdjacentCommunities.displayName="AdjacentCommunities",AdjacentCommunities.__docgenInfo={description:"",displayName:"AdjacentCommunities",props:{dataProvider:{defaultValue:null,description:"",name:"dataProvider",required:!0,type:{name:"CommunityDataProvider"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!0,type:{name:"boolean"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"ITableSettings"}},visibleColumns:{defaultValue:null,description:"",name:"visibleColumns",required:!0,type:{name:"string[]"}},minimizeColumns:{defaultValue:null,description:"",name:"minimizeColumns",required:!0,type:{name:"boolean"}},refresh:{defaultValue:null,description:"",name:"refresh",required:!0,type:{name:"boolean"}},selections:{defaultValue:null,description:"",name:"selections",required:!1,type:{name:"string[]"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!0,type:{name:"(id: string) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/CommunityCard/AdjacentCommunities/AdjacentCommunities.tsx#AdjacentCommunities"]={docgenInfo:AdjacentCommunities.__docgenInfo,name:"AdjacentCommunities",path:"../hierarchy-browser/src/CommunityCard/AdjacentCommunities/AdjacentCommunities.tsx#AdjacentCommunities"})}catch(__react_docgen_typescript_loader_error){}var src_select=__webpack_require__("../../.yarn/cache/d3-selection-npm-3.0.0-39a42b4ca9-0e5acfd305.zip/node_modules/d3-selection/src/select.js");const MagBar=function MagBar({percent,width=100,height=10}){const theme=(0,useThematic.J)(),ref=(0,react.useRef)(null);return(0,react.useLayoutEffect)((()=>{const foreground=theme.rect().fill().hex(),background=theme.application().faint().hex(),data=[{x:0,width:width*percent},{x:width*percent,width:width*(1-percent)}];(0,src_select.Z)(ref.current).select("svg").remove();(0,src_select.Z)(ref.current).append("svg").attr("width",width).attr("height",height).append("g").selectAll("rect").data(data).enter().append("rect").attr("fill",((d,i)=>0===i?foreground:background)).attr("width",(d=>d.width)).attr("height",height).attr("x",(d=>d.x)).attr("rx",1)}),[theme,percent,width,height]),(0,jsx_runtime.jsx)(MagBar_Container,{ref})},MagBar_Container=styled_components_browser_cjs.default.div``;try{MagBar.displayName="MagBar",MagBar.__docgenInfo={description:"This creates a percent-style bar.\nIt is monotone, using a foreground color for the percent,\nand a lighter variant for the background.",displayName:"MagBar",props:{percent:{defaultValue:null,description:"",name:"percent",required:!0,type:{name:"number"}},width:{defaultValue:{value:"100"},description:"",name:"width",required:!1,type:{name:"number"}},height:{defaultValue:{value:"10"},description:"",name:"height",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/MagBar/MagBar.tsx#MagBar"]={docgenInfo:MagBar.__docgenInfo,name:"MagBar",path:"../hierarchy-browser/src/MagBar/MagBar.tsx#MagBar"})}catch(__react_docgen_typescript_loader_error){}var max=__webpack_require__("../../.yarn/cache/d3-array-npm-3.2.4-b427632bcc-5800c467f8.zip/node_modules/d3-array/src/max.js");function exportCSVFile(items,fileTitle){const flatEntities=function flattenJSONObjects(entities){return entities.map((d=>d.attrs?Object.assign({},{id:d.id,...d.attrs}):d))}(items),headers=Object.keys(flatEntities[0]),datastring=function convertJSONToCSV(objArray){return objArray.reduce(((arg,item)=>{let str=arg;const keys=Object.keys(item);let line="";return keys.forEach((key=>{""!==line&&(line+=","),line+=item[key]})),str+=`${line}\r\n`,str}),"")}(flatEntities),headerstring=function convertHeaderToString(header){return header.reduce(((arg,key,i)=>{let str=arg;return""!==str&&(str+=","),str+=key,i===header.length-1&&(str+="\r\n"),str}),"")}(headers),exportedFilename=`${fileTitle}.csv`,blob=new Blob([headerstring+datastring],{type:"text/csv;charset=utf-8;"}),link=document.createElement("a");if(void 0!==link.download){const url=URL.createObjectURL(blob);link.setAttribute("href",url),link.setAttribute("download",exportedFilename),link.style.visibility="hidden",document.body.appendChild(link),link.click(),link.parentNode.removeChild(link)}}function isEntitiesAsync(entities){return!Array.isArray(entities)||entities instanceof Promise}function useCommunityDownload(communityId,size,getEntityCallback,level){const[isLoading,setIsLoading]=(0,react.useState)(!1),handleDownloadClick=(0,react.useCallback)((event=>{event.stopPropagation(),setIsLoading(!0),console.log(`initiated download of level: ${level} community: ${level}`),(async(communityId,size,getEntityCallback,level)=>{const response=await getEntityCallback(void 0,{loadCount:size,communityId}),filename=`c${communityId}_level${level}`;if(!response)throw Error("DataProvider undefined, unable to download CSV");exportCSVFile(response,filename)})(communityId,size,getEntityCallback,level).catch((reason=>{console.error(reason)})).finally((()=>setIsLoading(!1)))}),[communityId,setIsLoading,getEntityCallback,level,size]);return[handleDownloadClick,isLoading]}const SPINNER_STYLE={marginLeft:17},CommunityOverview=(0,react.memo)((function CommunityOverview({communityId,size,sizePercent,incrementLevel,onToggleOpen,filterProps,getEntityCallback,level,styles,controls,neighborSize}){const levelLabel=function useCommunityLevelText(level,incrementLevel){return(0,react.useMemo)((()=>`Level: ${incrementLevel?level+1:level}`),[incrementLevel,level])}(level,incrementLevel),style=function useThemesStyle(styles){const theme=(0,useThematic.J)(),style=(0,react.useMemo)((()=>styles?.root||{}),[styles]);return(0,react.useMemo)((()=>({background:theme.application().lowContrast().hex(),...style})),[theme,style])}(styles),[headerVariant,subheaderVariant,headerStyle,subheaderStyle,buttonStyle]=function useOverviewStyles(styles){const buttonStyle=styles?.iconButton??NO_ICON_STYLE,headerStyle=styles?.header??NO_STYLE,subheaderStyle=styles?.subheader??NO_STYLE;return[styles?.headerText??headerLabel,styles?.subHeaderText??subHeaderLabel,headerStyle,subheaderStyle,buttonStyle]}(styles),{showLevel,showMembership,showFilter,showExport}=function useControls(controls){return(0,react.useMemo)((()=>{let showLevel=!0,showMembership=!0,showExport=!0,showFilter=!0;return controls&&(showLevel=null!=controls.showLevel?controls.showLevel:showLevel,showMembership=null!=controls.showMembership?controls.showMembership:showMembership,showFilter=null!=controls.showFilter?controls.showFilter:showFilter,showExport=null!=controls.showExport?controls.showExport:showExport),{showLevel,showMembership,showExport,showFilter}}),[controls])}(controls),communityText=function useCommunityText(communityId){return(0,react.useMemo)((()=>`Community: ${communityId}`),[communityId])}(communityId),handleFilterChange=(0,react.useCallback)((event=>{event.stopPropagation(),filterProps.toggleFilter()}),[filterProps]),[handleDownload,downloadInProgress]=useCommunityDownload(communityId,size,getEntityCallback,level);return(0,jsx_runtime.jsx)(FlexyContainer,{onClick:onToggleOpen,style,className:"cardoverview-root",children:(0,jsx_runtime.jsxs)(Grid,{children:[(0,jsx_runtime.jsxs)(GridItem1,{children:[(0,jsx_runtime.jsx)(Divider,{className:"cardoverview-header",style:headerStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:headerVariant,children:(0,jsx_runtime.jsx)(CommunityOverview_Bold,{children:communityText})})}),showLevel?(0,jsx_runtime.jsx)(Divider,{className:"cardoverview-subheader",style:subheaderStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:subheaderVariant,children:levelLabel})}):null]}),neighborSize&&neighborSize>0?(0,jsx_runtime.jsx)(GridItem2,{children:(0,jsx_runtime.jsxs)(lib_commonjs.TooltipHost,{content:"Number of neighboring (connected) communities.  Members of neighboring communities may be related, but are less tightly connected that those within the community.",children:[(0,jsx_runtime.jsx)(Divider,{className:"cardoverview-subheader",style:subheaderStyle,children:(0,jsx_runtime.jsx)(lib_commonjs.Text,{variant:subheaderVariant,children:`Neighbors: ${neighborSize}`})}),(0,jsx_runtime.jsx)(HeightSpacer,{})]})}):null,(0,jsx_runtime.jsx)(GridItem3,{children:(0,jsx_runtime.jsxs)(FlexySubContainer,{children:[size&&showMembership?(0,jsx_runtime.jsxs)(Divider,{children:[(0,jsx_runtime.jsx)(Divider,{className:"cardoverview-subheader",style:subheaderStyle,children:(0,jsx_runtime.jsxs)(lib_commonjs.Text,{variant:subheaderVariant,children:["Members: ",size.toLocaleString()]})}),(0,jsx_runtime.jsx)(MagBar,{percent:sizePercent,width:120})]}):null,showFilter?(0,jsx_runtime.jsx)(lib_commonjs.TooltipHost,{content:`Show only unique entities between level ${level} and ${level+1}.`,children:(0,jsx_runtime.jsx)(lib_commonjs.IconButton,{styles:buttonStyle,iconProps:{iconName:filterProps.state?"Filter":"ClearFilter"},onClick:handleFilterChange,disabled:filterProps.disabled})}):null,showExport?(0,jsx_runtime.jsx)(lib_commonjs.TooltipHost,{content:"Download community as .csv file.",children:downloadInProgress?(0,jsx_runtime.jsx)(lib_commonjs.Spinner,{label:"",style:SPINNER_STYLE}):(0,jsx_runtime.jsx)(lib_commonjs.IconButton,{styles:buttonStyle,iconProps:{iconName:"DownloadDocument"},onClick:handleDownload})}):null]})})]})})})),Divider=styled_components_browser_cjs.default.div``,CommunityOverview_Bold=styled_components_browser_cjs.default.div`
	font-weight: bold;
`,FlexySubContainer=styled_components_browser_cjs.default.div`
	display: flex;
`,FlexyContainer=styled_components_browser_cjs.default.div`
	display: flex;
	justify-content: space-between;
	align-items: center;
	padding: 6px;
	cursor: cell;
	border-radius: 5px;
`,Grid=styled_components_browser_cjs.default.div`
	display: grid;
	grid-template-columns: 1fr 1fr 1fr;
	grid-column-gap: 8;
	grid-row-gap: 1;
	width: 100%;
`,GridItem1=styled_components_browser_cjs.default.div`
	margin-left: ${10};
	grid-row: 1;
	grid-column: 1;
`,GridItem2=styled_components_browser_cjs.default.div`
	grid-row: 1;
	grid-column: 2;
	justify-self: center;
`,HeightSpacer=styled_components_browser_cjs.default.div`
	visibility: hidden;
	height: 10px;
`,GridItem3=styled_components_browser_cjs.default.div`
	grid-row: 1;
	grid-column: 3;
	justify-self: end;
`;try{CommunityOverview.displayName="CommunityOverview",CommunityOverview.__docgenInfo={description:"",displayName:"CommunityOverview",props:{communityId:{defaultValue:null,description:"",name:"communityId",required:!0,type:{name:"string"}},size:{defaultValue:null,description:"",name:"size",required:!0,type:{name:"number"}},sizePercent:{defaultValue:null,description:"",name:"sizePercent",required:!0,type:{name:"number"}},incrementLevel:{defaultValue:null,description:"",name:"incrementLevel",required:!1,type:{name:"boolean"}},onToggleOpen:{defaultValue:null,description:"",name:"onToggleOpen",required:!0,type:{name:"() => void"}},filterProps:{defaultValue:null,description:"",name:"filterProps",required:!0,type:{name:"IFilterProps"}},getEntityCallback:{defaultValue:null,description:"",name:"getEntityCallback",required:!0,type:{name:"(pageNumber?: number, params?: IEntityLoadParams) => Promise<IEntityDetail[]>"}},level:{defaultValue:null,description:"",name:"level",required:!0,type:{name:"number"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"ICardOverviewSettings"}},controls:{defaultValue:null,description:"",name:"controls",required:!1,type:{name:"IControls"}},neighborSize:{defaultValue:null,description:"",name:"neighborSize",required:!1,type:{name:"number"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/CommunityCard/CommunityOverview.tsx#CommunityOverview"]={docgenInfo:CommunityOverview.__docgenInfo,name:"CommunityOverview",path:"../hierarchy-browser/src/CommunityCard/CommunityOverview.tsx#CommunityOverview"})}catch(__react_docgen_typescript_loader_error){}const CommunityCard=(0,react.memo)((function CommunityCard({maxSize,maxLevel,level,incrementLevel,neighborCallback,settings,dataProvider,toggleUpdate,selections,onSelectionChange}){const{isOpen:isOpenProp,minimizeColumns,visibleColumns,styles,controls}=settings;!function useUpdatedCommunityProvider(dataProvider,level,neighborCallback){(0,react.useEffect)((()=>{dataProvider.loadNeighborsCallback=neighborCallback}),[neighborCallback,dataProvider]),(0,react.useMemo)((()=>{dataProvider.level=level}),[level,dataProvider])}(dataProvider,level,neighborCallback);const[entities,isLoading,loadMore,hasMore,isOpen,toggleOpen,filterProps]=useCommunityData(dataProvider,isOpenProp,maxLevel),sizePercent=function useCommunitySizePercent(size,maxSize){return(0,react.useMemo)((()=>size/maxSize),[size,maxSize])}(dataProvider.size,maxSize),contentStyle=useContainerStyle(isOpen),loadingElement=(0,react.useMemo)((()=>isLoading?(0,jsx_runtime.jsx)(lib_commonjs.Spinner,{label:"Fetching entity data..."}):null),[isLoading]),handleEntityClick=(0,react.useCallback)((entiyId=>{if(onSelectionChange){const deduped=new Set(selections||[]);deduped.has(entiyId)?(deduped.delete(entiyId),onSelectionChange(Array.from(deduped))):(deduped.add(entiyId),onSelectionChange(Array.from(deduped)))}}),[onSelectionChange,selections]);return(0,jsx_runtime.jsxs)(CommunityCard_Container,{children:[(0,jsx_runtime.jsx)(CommunityOverview,{communityId:dataProvider.communityId,onToggleOpen:toggleOpen,incrementLevel,sizePercent,filterProps,getEntityCallback:loadMore,level,styles:styles?.cardOverview,controls,neighborSize:dataProvider.neighborSize,size:dataProvider.size}),(0,jsx_runtime.jsxs)(Flex,{children:[(0,jsx_runtime.jsxs)(CommunityCard_Content,{style:contentStyle,children:[entities?.length>0?(0,jsx_runtime.jsx)(ScrollArea,{loadMore,hasMore,children:(0,jsx_runtime.jsx)(CommunityTable,{entities,communityId:dataProvider.communityId,visibleColumns,styles:styles?.table,minimize:minimizeColumns,selections,onSelectionChange:handleEntityClick})}):null,loadingElement,(0,jsx_runtime.jsx)(EmptyEntityList,{filterProps,entities,isLoading})]}),(0,jsx_runtime.jsx)(AdjacentCommunities,{dataProvider,isOpen,styles:styles?.table,visibleColumns,minimizeColumns,refresh:toggleUpdate,selections,onSelectionChange:handleEntityClick})]})]})})),CommunityCard_Container=styled_components_browser_cjs.default.div``,Flex=styled_components_browser_cjs.default.div`
	display: flex;
`,CommunityCard_Content=styled_components_browser_cjs.default.div`
	overflow-y: auto;
	transition: height 0.2s;
`;try{CommunityCard.displayName="CommunityCard",CommunityCard.__docgenInfo={description:"",displayName:"CommunityCard",props:{maxSize:{defaultValue:null,description:"",name:"maxSize",required:!0,type:{name:"number"}},maxLevel:{defaultValue:null,description:"",name:"maxLevel",required:!0,type:{name:"number"}},level:{defaultValue:null,description:"",name:"level",required:!0,type:{name:"number"}},incrementLevel:{defaultValue:null,description:"",name:"incrementLevel",required:!1,type:{name:"boolean"}},neighborCallback:{defaultValue:null,description:"",name:"neighborCallback",required:!1,type:{name:"ILoadNeighborCommunities"}},settings:{defaultValue:null,description:"",name:"settings",required:!0,type:{name:"ISettings"}},dataProvider:{defaultValue:null,description:"",name:"dataProvider",required:!0,type:{name:"CommunityDataProvider"}},toggleUpdate:{defaultValue:null,description:"",name:"toggleUpdate",required:!0,type:{name:"boolean"}},selections:{defaultValue:null,description:"",name:"selections",required:!1,type:{name:"string[]"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"IOnSelectionChange"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/CommunityCard/CommunityCard.tsx#CommunityCard"]={docgenInfo:CommunityCard.__docgenInfo,name:"CommunityCard",path:"../hierarchy-browser/src/CommunityCard/CommunityCard.tsx#CommunityCard"})}catch(__react_docgen_typescript_loader_error){}const useEntityProvider=(communities,entities)=>{const isAsync=(0,react.useMemo)((()=>isEntitiesAsync(entities)),[entities]),entityMap=(0,react.useMemo)((()=>{if(!isAsync)return function createEntityMap(entities){if(entities)return entities.reduce(((acc,entity)=>(acc[entity.id]=entity,acc)),{})}(entities)}),[isAsync,entities]),getEntitiesAsync=(0,react.useCallback)((async loadParams=>await entities(loadParams)),[entities]),getStaticNeighborEntities=(0,react.useCallback)(((communities,entityMap,community)=>communities.reduce(((acc,d)=>(d.entityIds&&d.communityId===community&&(acc.current=acc.current.concat(d.entityIds)),acc)),{current:[]}).current.reduce(((acc,id)=>{const entity=entityMap[`${id}`];return entity&&acc.push(entity),acc}),[])),[]),getStaticNeighbor=(0,react.useCallback)(((communityId,neighborCommunities)=>{if(entityMap&&neighborCommunities.length>0){return{data:getStaticNeighborEntities(neighborCommunities,entityMap,communityId)}}return{error:new Error("No static neighbor entities loaded")}}),[entityMap,getStaticNeighborEntities]),getCommunityEntities=(0,react.useCallback)(((filtered,level,communityId)=>{if(entityMap&&communities){const data=function getStaticEntities(communities,entityMap,level,filtered,community){const levelIds=communities.reduce(((acc,d)=>(d.entityIds&&(d.communityId===community&&(acc.current=acc.current.concat(d.entityIds)),filtered&&d.level===level+1&&(acc.next=acc.next?.concat(d.entityIds))),acc)),{current:[],next:[]}),seen=new Set(levelIds.next);return levelIds.current.reduce(((acc,id)=>{const entity=entityMap[`${id}`];return entity&&(filtered&&seen.has(id)||acc.push(entity)),acc}),[])}(communities,entityMap,level,filtered,communityId);return{data}}return{error:new Error("No static entities loaded")}}),[communities,entityMap]),getStaticEntitiesByType=(0,react.useCallback)(((loadParams,neighborCommunities,type)=>{const{filtered,level,communityId}=loadParams;return type===ENTITY_TYPE.NEIGHBOR?getStaticNeighbor(communityId,neighborCommunities):getCommunityEntities(filtered,level,communityId)}),[getStaticNeighbor,getCommunityEntities]);return(0,react.useCallback)((async(loadParams,neighborCommunities,type)=>isAsync?await getEntitiesAsync(loadParams):getStaticEntitiesByType(loadParams,neighborCommunities,type)),[getStaticEntitiesByType,isAsync,getEntitiesAsync])};function useSettings(settings){const getOpenState=(0,react.useCallback)((index=>void 0!==settings?.isOpen?settings.isOpen:0===index),[settings]);return(0,react.useCallback)((index=>({isOpen:getOpenState(index),...settings})),[getOpenState,settings])}try{useSettings.displayName="useSettings",useSettings.__docgenInfo={description:"",displayName:"useSettings",props:{visibleColumns:{defaultValue:null,description:"",name:"visibleColumns",required:!1,type:{name:"string[]"}},styles:{defaultValue:null,description:"",name:"styles",required:!1,type:{name:"IStyles"}},isOpen:{defaultValue:null,description:"",name:"isOpen",required:!1,type:{name:"boolean"}},minimizeColumns:{defaultValue:null,description:"",name:"minimizeColumns",required:!1,type:{name:"boolean"}},controls:{defaultValue:null,description:"",name:"controls",required:!1,type:{name:"IControls"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/hooks/useSettings.tsx#useSettings"]={docgenInfo:useSettings.__docgenInfo,name:"useSettings",path:"../hierarchy-browser/src/hooks/useSettings.tsx#useSettings"})}catch(__react_docgen_typescript_loader_error){}const HierarchyBrowser=function HierarchyBrowser({communities,entities,neighbors,settings,selections,onSelectionChange}){const[providerCache,setProviderCache]=(0,react.useState)({}),[selectedIds,setSelectedIds]=(0,react.useState)(),[forceUpdateNeighbors,setForceNeighborUpdate]=(0,react.useState)(!1);(0,react.useEffect)((()=>{setForceNeighborUpdate((state=>!state))}),[communities,neighbors]),(0,react.useLayoutEffect)((()=>{setSelectedIds(selections)}),[selections]);const neighborCallback=(0,react.useCallback)((async(params,communityId)=>{if(neighbors){if(isEntitiesAsync(neighbors)){const loader=neighbors;return await loader(params)}return{data:neighbors.filter((d=>d.edgeCommunityId===communityId)),error:void 0}}return{data:[],error:new Error("neighbor communities not loaded")}}),[neighbors]),[minLevel,maxLevel,communityWithLevels]=function useCommunityLevelCalculator(data){const[min,max]=(0,react.useMemo)((()=>[0,data.length-1]),[data]);return[min,max,(0,react.useMemo)((()=>[...data].reverse().map(((comm,index)=>({...comm,level:index})))),[data])]}(communities),maxSize=function useCommunitySizeCalculator(data){return(0,react.useMemo)((()=>(0,max.Z)(data,(d=>d.size))||0),[data])}(communities);(({communities,setProviderCache,loadEntitiesByCommunity})=>{(0,react.useMemo)((()=>{setProviderCache((cache=>{const communityIds=communities.map((c=>c.communityId)),intersection=Object.keys(cache).filter((value=>communityIds.includes(value)));return communities.reduce(((acc,community)=>{if(cache[community.communityId]){if(intersection.includes(community.communityId)){const provider=cache[community.communityId];provider.updateCommunityData(community),provider.updateEntityLoader(loadEntitiesByCommunity),acc[community.communityId]=provider}}else{const provider=new CommunityDataProvider(community,loadEntitiesByCommunity,community.level);acc[community.communityId]=provider}return acc}),{})}))}),[communities,setProviderCache,loadEntitiesByCommunity])})({communities:communityWithLevels,setProviderCache,loadEntitiesByCommunity:useEntityProvider(communityWithLevels,entities)});const cardOrder=(0,react.useMemo)((()=>communities.reduce(((acc,c,index)=>(acc[c.communityId]=index,acc)),{})),[communities]),getSettings=useSettings(settings),sortedKeys=(0,react.useMemo)((()=>Object.keys(providerCache).sort(((a,b)=>cardOrder[a]-cardOrder[b]))),[providerCache,cardOrder]),getCommunityProvider=(0,react.useCallback)((communityId=>providerCache[communityId]),[providerCache]);return(0,jsx_runtime.jsx)(CardContainer,{children:sortedKeys.map(((communityId,index)=>{const provider=getCommunityProvider(communityId),cardSettings=getSettings(index);return(0,jsx_runtime.jsx)(CommunityCard,{incrementLevel:0===minLevel,maxSize,maxLevel,level:maxLevel-index,dataProvider:provider,neighborCallback,settings:cardSettings,toggleUpdate:forceUpdateNeighbors,selections:selectedIds,onSelectionChange},`_card_${index}_${communityId}`)}))})},CardContainer=styled_components_browser_cjs.default.div`
	margin: 10px 10px 10px 10px;
	overflow-y: auto;
`;try{HierarchyBrowser.displayName="HierarchyBrowser",HierarchyBrowser.__docgenInfo={description:"Component creates tables to view connected data while also applying default thematic styles and data colors.",displayName:"HierarchyBrowser",props:{communities:{defaultValue:null,description:"",name:"communities",required:!0,type:{name:"ICommunityDetail[]"}},entities:{defaultValue:null,description:"",name:"entities",required:!1,type:{name:"IEntityDetail[] | ILoadEntitiesAsync"}},neighbors:{defaultValue:null,description:"",name:"neighbors",required:!1,type:{name:"INeighborCommunityDetail[] | ILoadNeighborCommunitiesAsync"}},settings:{defaultValue:null,description:"",name:"settings",required:!1,type:{name:"ISettings"}},selections:{defaultValue:null,description:"",name:"selections",required:!1,type:{name:"string[]"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"IOnSelectionChange"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/HierarchyBrowser.tsx#HierarchyBrowser"]={docgenInfo:HierarchyBrowser.__docgenInfo,name:"HierarchyBrowser",path:"../hierarchy-browser/src/HierarchyBrowser.tsx#HierarchyBrowser"})}catch(__react_docgen_typescript_loader_error){}var injectStylesIntoStyleTag=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("../../.yarn/__virtual__/style-loader-virtual-03f861ac5d/0/cache/style-loader-npm-3.3.3-2e8bbeeac4-6c13d5075b.zip/node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),Style=__webpack_require__("../../.yarn/__virtual__/css-loader-virtual-348563e213/0/cache/css-loader-npm-6.8.1-30d84b4cf1-f20bb2a181.zip/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[7].use[1]!../hierarchy-browser/src/__tests__/utils/components/Selections/Style.css"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(Style.Z,options);Style.Z&&Style.Z.locals&&Style.Z.locals;const styles={flexContainer:{display:"inline-flex"}},Selections=(0,react.memo)((function Selections({options,defaultSelectedKey,onChange,label}){const _onChange=(0,react.useCallback)(((ev,option)=>{option&&onChange(option)}),[onChange]);return(0,jsx_runtime.jsx)(lib_commonjs.ChoiceGroup,{styles,defaultSelectedKey,options,onChange:_onChange,label,required:!0,className:"hierarchy-choice-group"})})),style={display:"inline-flex"},ToggleBaseStyle={container:{margin:"10px"}},ToggleAugmentStyle={container:{margin:"10px"},root:{marginLeft:"20px"}},ControlGroup=(0,react.memo)((function ControlGroup({loadState,defaultSelectedKey,onChange,options,handleNeighborsLoaded,showCustomStyles,onStyleChange}){return(0,jsx_runtime.jsxs)("div",{style,children:[(0,jsx_runtime.jsx)(Selections,{options,defaultSelectedKey:`${defaultSelectedKey}`,label:"selected community",onChange}),(0,jsx_runtime.jsx)(lib_commonjs.Toggle,{label:"neighbors loaded",checked:loadState,onChange:handleNeighborsLoaded,styles:ToggleBaseStyle}),(0,jsx_runtime.jsx)(lib_commonjs.Toggle,{label:"custom styles",checked:showCustomStyles,onChange:onStyleChange,styles:ToggleAugmentStyle})]})}));try{Selections.displayName="Selections",Selections.__docgenInfo={description:"",displayName:"Selections",props:{options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"IChoiceGroupOption[]"}},defaultSelectedKey:{defaultValue:null,description:"",name:"defaultSelectedKey",required:!0,type:{name:"string"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(option: IChoiceGroupOption) => void"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/__tests__/utils/components/Selections/Selections.tsx#Selections"]={docgenInfo:Selections.__docgenInfo,name:"Selections",path:"../hierarchy-browser/src/__tests__/utils/components/Selections/Selections.tsx#Selections"})}catch(__react_docgen_typescript_loader_error){}try{ControlGroup.displayName="ControlGroup",ControlGroup.__docgenInfo={description:"",displayName:"ControlGroup",props:{options:{defaultValue:null,description:"",name:"options",required:!0,type:{name:"IChoiceGroupOption[]"}},defaultSelectedKey:{defaultValue:null,description:"",name:"defaultSelectedKey",required:!0,type:{name:"number"}},onChange:{defaultValue:null,description:"",name:"onChange",required:!0,type:{name:"(option: IChoiceGroupOption) => void"}},handleNeighborsLoaded:{defaultValue:null,description:"",name:"handleNeighborsLoaded",required:!0,type:{name:"(ev: MouseEvent<HTMLElement, MouseEvent>, checked?: boolean) => void"}},loadState:{defaultValue:null,description:"",name:"loadState",required:!1,type:{name:"boolean"}},showCustomStyles:{defaultValue:null,description:"",name:"showCustomStyles",required:!1,type:{name:"boolean"}},onStyleChange:{defaultValue:null,description:"",name:"onStyleChange",required:!0,type:{name:"(ev: MouseEvent<HTMLElement, MouseEvent>, checked?: boolean) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../hierarchy-browser/src/__tests__/utils/components/Selections/Selections.tsx#ControlGroup"]={docgenInfo:ControlGroup.__docgenInfo,name:"ControlGroup",path:"../hierarchy-browser/src/__tests__/utils/components/Selections/Selections.tsx#ControlGroup"})}catch(__react_docgen_typescript_loader_error){}const visibleColumns=["x","y","d"],utils_options=[{key:"204",text:"204"},{key:"205",text:"205"},{key:"128",text:"128"},{key:"130",text:"130"}],customStyle={cardOverview:{root:{border:"1px solid white",borderRadius:"0px",background:"black"},header:{color:"#f683ba"},headerText:"mediumPlus",subHeaderText:"medium",subheader:{color:"white"},iconButton:{root:{color:"#f683ba"}}},table:{header:{color:"#f683ba",height:"10px"},headerText:"small",subHeaderText:"tiny",subheader:{fontStyle:"italic"},tableItems:{fontStyle:"italic",textAlign:"center"},tableItemsText:"large",neighborExpandButton:{root:{color:"black"}},root:{background:"#ced4e4"}}};function search(p,clusterIDMap){const container=[];if(p.length>0){return innerSearch(p,clusterIDMap,container)}}function innerSearch(parents,clusterIDMap,container){return parents.length>0&&parents.forEach((d=>{const values=clusterIDMap[`${d}`],p=values.reduce(((acc,d)=>(d.parentCluster&&acc.add(`${d.parentCluster}`),acc)),new Set([]));container.push(values),innerSearch(Array.from(p),clusterIDMap,container)})),container}const loadRemoteData=async(url,setFunc)=>{const resp=await fetch(url),parsedData=function CSVToArray(strData,strDelimiter){const delim=strDelimiter||",",objPattern=new RegExp(`(\\${delim}|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\${delim}\\r\\n]*))`,"gi"),arrData=[[]];let arrMatches=objPattern.exec(strData);for(;arrMatches;){const strMatchedDelimiter=arrMatches[1];strMatchedDelimiter.length&&strMatchedDelimiter!==delim&&arrData.push([]);let strMatchedValue="";strMatchedValue=arrMatches[2]?arrMatches[2].replace(/""/g,'"'):arrMatches[3],arrData[arrData.length-1].push(strMatchedValue),arrMatches=objPattern.exec(strData)}return arrData}(await resp.text(),","),header=parsedData[0];setFunc(parsedData.slice(1).map((arr=>header.reduce(((accum,colName,index)=>{let value=arr[index];return value=Number.isNaN(+value)?value:+value,{...accum,[colName]:value}}),{}))))};function useData(selectedOption){const[nodes,setNodes]=(0,react.useState)(),[edges,setEdges]=(0,react.useState)(),[join,setJoin]=(0,react.useState)(),clusterIdMap=(0,react.useMemo)((()=>{if(join)return join.reduce(((acc,d)=>(acc[`${d.clusterId}`]?acc[`${d.clusterId}`]=[...acc[`${d.clusterId}`],d]:acc[`${d.clusterId}`]=[d],acc)),{})}),[join]),searchForChildren=(0,react.useCallback)((selection=>{if(clusterIdMap)return search([selection],clusterIdMap)}),[clusterIdMap]),selectedJoin=(0,react.useMemo)((()=>searchForChildren(selectedOption)),[searchForChildren,selectedOption]),communityMap=(0,react.useMemo)((()=>{if(join)return join.reduce(((acc,d)=>(acc[`${d.nodeId}`],acc[`${d.nodeId}`]=d,acc)),{})}),[join]),nodeMap=(0,react.useMemo)((()=>{if(nodes)return nodes.reduce(((acc,d)=>(acc[d.id]=d,acc)),{})}),[nodes]),edgeMap=(0,react.useMemo)((()=>{if(edges)return edges.reduce(((acc,d)=>{const id=d.source;return acc[id]=d.target,acc[d.target]=id,acc}),{})}),[edges]);(0,react.useEffect)((()=>{nodes||loadRemoteData("./data/static/nodes.csv",setNodes),edges||loadRemoteData("./data/static/edges.csv",setEdges),join||loadRemoteData("./data/static/join.csv",setJoin)}),[setNodes,setEdges,setJoin,nodes,edges,join]);const[comm,entities,neighborComm]=(0,react.useMemo)((()=>{if(nodeMap&&selectedJoin&&edgeMap&&communityMap){const container=[[],[],[]],arrays=selectedJoin.map((arr=>{const clusterId=arr[0].clusterId,selectedNodes=arr.map((d=>{const node=nodeMap[d.nodeId];return{id:node.id,attrs:{...node},cid:`${d.clusterId}`}})),selectedEdges=arr.reduce(((acc,d)=>{const targetId=edgeMap[d.nodeId],targetNode=nodeMap[targetId];if(targetNode){const clusterId=`${communityMap[targetId].clusterId}`,o={id:targetNode.id,attrs:{...targetNode},cid:clusterId,neighbor:`${d.clusterId}`};acc.push(o)}return acc}),[]);return{communityId:`${clusterId}`,size:arr.length,nodes:selectedNodes,edges:selectedEdges,neighborSize:selectedEdges.length}})).reduce(((acc,o)=>{const entityIds=o.nodes.map((d=>d.id)),comm={communityId:o.communityId,entityIds,size:o.size,neighborSize:o.neighborSize},nodes=o.nodes,edges=o.edges;return acc[0].push(comm),acc[1]=[...acc[1],...nodes],acc[2]=[...acc[2],...edges],acc}),container);return arrays}return[[],[],[]]}),[selectedJoin,nodeMap,edgeMap,communityMap]);return[comm,entities,neighborComm,searchForChildren]}const HierarchyBrowser_stories={title:"@essex:hierarchy-browser/HierarchyBrowser"},DEFAULT_SELECTIONS=["4_100"],AsyncComponent=()=>{const[selectedOption,onChange,loadState,handleNeighborsLoaded,handleStyleChange,showCustomStyles,settings]=function useHierarchyState(){const[selectedOption,setSelectedOption]=(0,react.useState)("204"),[loadState,setLoadState]=(0,react.useState)(!1),[showCustomStyles,setCustomStyles]=(0,react.useState)(!1),onChange=(0,react.useCallback)((option=>setSelectedOption(option.key)),[setSelectedOption]),handleStyleChange=(0,react.useCallback)(((ev,checked)=>setCustomStyles(checked)),[setCustomStyles]),handleNeighborsLoaded=(0,react.useCallback)(((ev,checked)=>setLoadState(checked)),[setLoadState]),settings=(0,react.useMemo)((()=>({visibleColumns,controls:{showFilter:!1},styles:showCustomStyles?customStyle:{}})),[showCustomStyles]);return[selectedOption,onChange,loadState,handleNeighborsLoaded,handleStyleChange,showCustomStyles,settings]}(),[communities,nodes,edges,searchForChildren]=useData(selectedOption),[selectionState,setSelectionState]=(0,react.useState)(DEFAULT_SELECTIONS),[getEntities,getNeighbors]=function useAsyncCallbacks({nodes,edges,loadState,searchForChildren}){const allEntities=(0,react.useMemo)((()=>[...nodes,...edges]),[nodes,edges]);return[(0,react.useCallback)((async params=>{if(await Promise.resolve(),allEntities){const communityId=params.communityId;return{data:allEntities.reduce(((acc,d)=>(`${d.cid}`!==communityId||acc[0].has(d.id)||(acc[0].add(d.id),acc[1].push(d)),acc)),[new Set([]),[]])[1],error:void 0}}return{error:new Error("nodes not loaded in meta"),data:void 0}}),[allEntities]),(0,react.useCallback)((async params=>{if(await Promise.resolve(),edges&&loadState){const parents=edges.filter((d=>`${d.neighbor}`===params.communityId)).reduce(((acc,e)=>(acc[e.cid]=acc[e.cid]?acc[e.cid]+1:1,acc)),{});return{data:Object.keys(parents).map((key=>{const connections=parents[key],edgeCommunityId=params.communityId,communityId=key,values=searchForChildren(communityId);let count=0;return values&&(count=values.reduce(((counter,arr)=>arr.length+counter),0)),{communityId,edgeCommunityId,connections,size:count}}))}}return{error:new Error("edges not loaded in meta")}}),[edges,loadState,searchForChildren])]}({nodes,edges,loadState,searchForChildren}),HB=(0,react.useMemo)((()=>communities?(0,jsx_runtime.jsx)(HierarchyBrowser,{communities,entities:getEntities,neighbors:getNeighbors,settings,selections:selectionState,onSelectionChange:setSelectionState}):null),[communities,getEntities,getNeighbors,settings,selectionState]);return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(ControlGroup,{loadState,defaultSelectedKey:204,onChange,options:utils_options,handleNeighborsLoaded,showCustomStyles,onStyleChange:handleStyleChange}),HB]})},SyncComponent=()=>{const[selectedOption,setSelectedOption]=(0,react.useState)("204"),onChange=(0,react.useCallback)((option=>setSelectedOption(option.key)),[setSelectedOption]),[communities,nodes,edges,searchForChildren]=useData(selectedOption),[neighborData,allEntities]=function useStaticEntities({communities,edges,nodes,searchForChildren}){const allEntities=(0,react.useMemo)((()=>[...nodes,...edges]),[nodes,edges]),getNeighbors=(0,react.useCallback)((communityId=>{if(edges&&allEntities){const parents=edges.filter((d=>`${d.neighbor}`===communityId)).reduce(((acc,e)=>(acc[e.cid]=acc[e.cid]?acc[e.cid]+1:1,acc)),{});return Object.keys(parents).map((key=>{const connections=parents[key],edgeCommunityId=communityId,commID=key,values=searchForChildren(commID);let ids=[];return values&&(ids=values.reduce(((totalEntities,arr)=>totalEntities.concat(arr)),[]).map((d=>d.nodeId))),{communityId:commID,edgeCommunityId,connections,entityIds:ids,size:ids.length}}))}return[]}),[edges,allEntities,searchForChildren]);return[(0,react.useMemo)((()=>communities.reduce(((acc,d)=>[...acc,...getNeighbors(d.communityId)]),[])),[getNeighbors,communities]),allEntities]}({communities,nodes,edges,searchForChildren});return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)(Selections,{options:utils_options,defaultSelectedKey:"204",label:"selected community",onChange}),communities&&(0,jsx_runtime.jsx)(HierarchyBrowser,{communities,entities:allEntities,neighbors:neighborData,settings:{visibleColumns}})]})},HierarchyBrowserAsync={render:()=>(0,jsx_runtime.jsx)(AsyncComponent,{}),name:"Async"},HierarchyBrowserSynchronous={render:()=>(0,jsx_runtime.jsx)(SyncComponent,{}),name:"Synchronous"};HierarchyBrowserAsync.parameters={...HierarchyBrowserAsync.parameters,docs:{...HierarchyBrowserAsync.parameters?.docs,source:{originalSource:"{\n  render: () => <AsyncComponent />,\n  name: 'Async'\n}",...HierarchyBrowserAsync.parameters?.docs?.source}}},HierarchyBrowserSynchronous.parameters={...HierarchyBrowserSynchronous.parameters,docs:{...HierarchyBrowserSynchronous.parameters?.docs,source:{originalSource:"{\n  render: () => <SyncComponent />,\n  name: 'Synchronous'\n}",...HierarchyBrowserSynchronous.parameters?.docs?.source}}}}}]);
//# sourceMappingURL=hierarchy-browser-src-__tests__-HierarchyBrowser-stories.0fe9b64b.iframe.bundle.js.map