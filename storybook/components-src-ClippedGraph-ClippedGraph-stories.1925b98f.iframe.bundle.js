/*! For license information please see components-src-ClippedGraph-ClippedGraph-stories.1925b98f.iframe.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkessex_toolkit_stories=self.webpackChunkessex_toolkit_stories||[]).push([[2378],{"../../.yarn/__virtual__/@thematic-d3-virtual-edaaeda702/0/cache/@thematic-d3-npm-2.0.22-01fffb296c-2f9005e50f.zip/node_modules/@thematic/d3/dist/layers.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{bW:()=>chart,vq:()=>plotArea,yo:()=>axis});var _svg_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("../../.yarn/__virtual__/@thematic-d3-virtual-edaaeda702/0/cache/@thematic-d3-npm-2.0.22-01fffb296c-2f9005e50f.zip/node_modules/@thematic/d3/dist/svg.js");function getSelectionOptions(_selection,options){return{on:(null==options?void 0:options.on)||{},attr:(null==options?void 0:options.attr)||{},classed:(null==options?void 0:options.classed)||{},style:(null==options?void 0:options.style)||{}}}function attr(selection,attrs){let ret=selection;return Object.entries(attrs||{}).forEach((entry=>{const[key,value]=entry;ret=selection.attr(key,value)})),ret}function on(selection,ons){let ret=selection;return Object.entries(ons||{}).forEach((entry=>{const[key,value]=entry;ret=selection.on(key,value)})),ret}function classed(selection,classes){let ret=selection;return Object.entries(classes||{}).forEach((entry=>{const[key,value]=entry;ret=selection.classed(key,value)})),ret}function style(selection,styles){let ret=selection;return Object.entries(styles||{}).forEach((entry=>{const[key,value]=entry;ret=selection.style(key,value)})),ret}function applyBaseOptions(selection,options){return selection.call(on,null==options?void 0:options.on).call(attr,null==options?void 0:options.attr).call(classed,null==options?void 0:options.classed).call(style,null==options?void 0:options.style)}function chart(svg,theme,options){const opts=function getChartOptions(selection,options){const w=null==options?void 0:options.width,h=null==options?void 0:options.height,width=w||+selection.attr("width")||0,height=h||+selection.attr("height")||0,sOpts=getSelectionOptions(0,options);return{on:sOpts.on,attr:{width,height,...sOpts.attr},classed:sOpts.classed,style:sOpts.style}}(svg,options);return svg.classed("thematic-chart",!0).call(_svg_js__WEBPACK_IMPORTED_MODULE_0__.JW,theme.chart()).call(applyBaseOptions,opts)}function plotArea(group,theme,options){const p=theme.plotArea(),opts=function getPlotAreaOptions(selection,options){const marginTop=(null==options?void 0:options.marginTop)||0,marginBottom=(null==options?void 0:options.marginBottom)||0,marginLeft=(null==options?void 0:options.marginLeft)||0,marginRight=(null==options?void 0:options.marginRight)||0,w=null==options?void 0:options.width,h=null==options?void 0:options.height,parent=selection.select((function(){return this.parentNode})),pw=parent&&+parent.attr("width")||0,ph=parent&&+parent.attr("height")||0,width=w||pw-marginLeft-marginRight,height=h||ph-marginTop-marginBottom,sOpts=getSelectionOptions(0,options);return{width,height,marginTop,marginBottom,marginLeft,marginRight,on:sOpts.on,attr:{width,height,...sOpts.attr},classed:sOpts.classed,style:sOpts.style}}(group,options),{marginTop,marginLeft}=opts;return group.classed("thematic-plot-area",!0).attr("transform",`translate(${null!=marginLeft?marginLeft:0},${null!=marginTop?marginTop:0})`),group.select(".thematic-plot-area-background").remove(),group.insert("rect",":first-child").classed("thematic-plot-area-background",!0).call(_svg_js__WEBPACK_IMPORTED_MODULE_0__.Pc,p).call(applyBaseOptions,opts),group}function axis(group,theme,axisGenerator,options){const opts=getSelectionOptions(0,options),ticks=theme.axisTicks();return axisGenerator.tickSizeInner(ticks.innerSize()),axisGenerator.tickSizeOuter(ticks.outerSize()),group.call(axisGenerator).call((g=>g.select(".domain").call(_svg_js__WEBPACK_IMPORTED_MODULE_0__.n8,theme.axisLine()))).call((g=>g.selectAll(".tick > line").call(_svg_js__WEBPACK_IMPORTED_MODULE_0__.n8,ticks))).call((g=>g.selectAll(".tick > text").call(_svg_js__WEBPACK_IMPORTED_MODULE_0__.Qq,theme.axisTickLabels()))).call(applyBaseOptions,opts),group}},"../../.yarn/__virtual__/@thematic-d3-virtual-edaaeda702/0/cache/@thematic-d3-npm-2.0.22-01fffb296c-2f9005e50f.zip/node_modules/@thematic/d3/dist/svg.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function svg(selection,child){return selection.attr("fill",child.backgroundColor().hex())}function mark(selection,child){return selection.attr("fill",(d=>child.fill(d).hex())).attr("fill-opacity",(d=>child.fillOpacity(d))).attr("stroke",(d=>child.stroke(d).hex())).attr("stroke-opacity",(d=>child.strokeOpacity(d))).attr("stroke-width",(d=>child.strokeWidth(d)))}function rect(selection,child){return selection.call(mark,child)}function line(selection,child){return selection.call(mark,child)}function text(selection,child){return selection.attr("font-size",child.fontSize()).attr("font-family",child.fontFamily()).call(mark,child)}__webpack_require__.d(__webpack_exports__,{JW:()=>svg,Pc:()=>rect,Qq:()=>text,n8:()=>line})},"../components/src/ClippedGraph/ClippedGraph.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ClippedGradient:()=>ClippedGradient,ClippedHorizon:()=>ClippedHorizon,Primary:()=>Primary,default:()=>ClippedGraph_stories});var jsx_runtime=__webpack_require__("../../.yarn/cache/react-npm-18.3.1-af38f3c1ae-261137d3f3.zip/node_modules/react/jsx-runtime.js");const standardHistogram=(data,bins,accessor=(d=>d))=>{const values=data.map((d=>accessor(d))),ext=(values=>values.reduce(((acc,cur)=>[Math.min(acc[0],cur),Math.max(acc[1],cur)]),[Number.MAX_VALUE,Number.MIN_VALUE]))(values),[min,max]=ext,binSize=(max-min)/bins,binStructure=new Array(bins).fill(1).map(((d,i)=>{const bin=[];return bin.x0=binSize*i+min,bin.x1=binSize*(i+1)+min,bin}));return values.reduce(((acc,cur)=>{const index=binStructure.findIndex((bin=>cur>=bin.x0&&cur<=bin.x1));return acc[index<0?acc.length-1:index].push(cur),acc}),binStructure)},findForwardBreak=(data,start)=>{const value=data[start-1];for(let i=start;i<data.length;i++)if(data[i]!==value)return i-start;return data.length-start},findBackwardBreak=(data,start)=>{const value=data[start-1];for(let i=start-1;i>=0;i--)if(data[i]!==value)return start-i-1;return start},histogram=(data,bins,accessor=(d=>d),quantize,smooth)=>quantize?((data,bins,accessor=(d=>d),smooth)=>{const values=data.map((d=>accessor(d))).sort(((a,b)=>a-b));let binLength=Math.ceil(values.length/bins);const binStructure=[];let start=0;for(let i=0;i<bins;i++){const end=start+binLength,forward=findForwardBreak(values,end),backward=findBackwardBreak(values,end),newEnd=smooth&&backward<forward&&backward<binLength?end-backward:end+forward,bin=values.slice(start,newEnd);bin.length>0&&(bin.x0=bin[0],bin.x1=bin[bin.length-1],binStructure.push(bin)),start=newEnd,newEnd!==end&&(binLength=Math.ceil((values.length-newEnd)/(bins-(i+1))))}return binStructure})(data,bins,accessor,smooth):standardHistogram(data,bins,accessor);var dist_layers=__webpack_require__("../../.yarn/__virtual__/@thematic-d3-virtual-edaaeda702/0/cache/@thematic-d3-npm-2.0.22-01fffb296c-2f9005e50f.zip/node_modules/@thematic/d3/dist/layers.js"),dist_svg=__webpack_require__("../../.yarn/__virtual__/@thematic-d3-virtual-edaaeda702/0/cache/@thematic-d3-npm-2.0.22-01fffb296c-2f9005e50f.zip/node_modules/@thematic/d3/dist/svg.js"),useThematic=__webpack_require__("../../.yarn/__virtual__/@thematic-react-virtual-1d715ad545/0/cache/@thematic-react-npm-2.1.9-5021c00aed-19e6347a18.zip/node_modules/@thematic/react/dist/useThematic.js"),linear=__webpack_require__("../../.yarn/cache/d3-scale-npm-4.0.2-d17a53447b-e2dc424358.zip/node_modules/d3-scale/src/linear.js"),src_select=__webpack_require__("../../.yarn/cache/d3-selection-npm-3.0.0-39a42b4ca9-0e5acfd305.zip/node_modules/d3-selection/src/select.js"),react=__webpack_require__("../../.yarn/cache/react-npm-18.3.1-af38f3c1ae-261137d3f3.zip/node_modules/react/index.js");const ClippedGraph=({data,width,height,clipped,percentile=90,gradient,gradientInterpolation=4,gradientBand=0,horizon,sparkline})=>{const theme=(0,useThematic.t)(),ref=(0,react.useRef)(null),smoothed=(0,react.useMemo)((()=>((data,multiple,accessor=(d=>d))=>data.reduce(((acc,cur,idx,arr)=>{const a=cur,b=arr[idx+1],av=accessor(a);if(b){const part=(accessor(b)-av)/multiple,parts=[];for(let i=0;i<multiple;i++)parts.push(av+part*i);return[...acc,...parts]}return[...acc,av]}),[]))(data,gradientInterpolation)),[data,gradientInterpolation]),histo=(0,react.useMemo)((()=>histogram(data,10,(d=>d),!0)),[data]);return(0,react.useEffect)((()=>{const len=histo.length,fullMax=histo[len-1].x1,percBin=Math.round(percentile/10)-1,clippedMax=clipped?histo[percBin].x1:fullMax,sPer=width/smoothed.length,color=theme.scales().sequential([0,fullMax]),yScale=(0,linear.A)().domain([0,clippedMax]).range([height,gradientBand]),xScale=(0,linear.A)().domain([0,data.length-1]).range([0,width]),sScale=(0,linear.A)().domain([0,smoothed.length-1]).range([0,width]),svg=(0,src_select.A)(ref.current);svg.selectAll("*").remove(),svg.call(dist_layers.bW,theme,{width,height});const g=svg.append("g").call(dist_layers.vq,theme),line=data.reduce(((acc,cur,idx)=>`${acc}L${xScale(idx)},${yScale(cur)}`),""),path=`M0,${yScale(data[0])}${line}`,clip=`M0,${height}${line}L${width},${height}`,clipId=`gradient-clip-${Math.random()}`;if(svg.append("clipPath").attr("id",`full-${clipId}`).append("path").attr("d",clip),svg.append("clipPath").attr("id",`band-${clipId}`).append("rect").attr("width",width).attr("height",gradientBand),svg.append("clipPath").attr("id",`plot-${clipId}`).append("rect").attr("width",width).attr("height",height-gradientBand).attr("y",gradientBand),horizon){const wrapCount=Math.ceil(Math.abs(yScale(fullMax)||0)/height);for(let w=0;w<=wrapCount;w++)g.append("g").append("path").attr("d",clip).attr("transform",`translate(0,${height*w})`).attr("fill",(()=>color(fullMax*(w/wrapCount)).hex())).attr("stroke","none"),g.append("g").append("path").attr("d",path).attr("transform",`translate(0,${height*w})`).call(dist_svg.n8,theme.line()).attr("stroke",theme.application().accent().hex())}gradient&&g.append("g").attr("clip-path",`url(#${gradientBand>0?"band":"full"}-${clipId})`).selectAll(".gradient").data(smoothed).enter().append("rect").attr("class","gradient").attr("x",((_d,i)=>(sScale(i)||0)-sPer/2)).attr("height",gradientBand||height).attr("width",sPer).attr("fill",(d=>color(d).hex())).attr("stroke",(d=>color(d).hex())),horizon||g.append("g").attr("clip-path",`url(#plot-${clipId})`).append("path").attr("d",path).call(dist_svg.n8,sparkline?theme.gridLines():theme.line()).attr("stroke",theme.application().accent().hex())}),[theme,smoothed,gradient,gradientInterpolation,gradientBand,horizon,histo,width,height,percentile,clipped,data,sparkline]),(0,jsx_runtime.jsx)("svg",{ref,width,height})};try{ClippedGraph.displayName="ClippedGraph",ClippedGraph.__docgenInfo={description:'Creates a line chart that handles extreme distributions with a few clipping/wrapping strategies.\nThe "clipped graph" concept was presented by Haihan Lin at VIS2019.\nhttps://vdl.sci.utah.edu/publications/2019_infovis_clipped_graphs/\nThis chart can also produce a horizon plot, or be formatted to look like a sparkline.\nFor examples of these variants, see the visual sandbox:\nhttps://visualsandbox.azurewebsites.net/#/experiments/clipped-graphs',displayName:"ClippedGraph",props:{data:{defaultValue:null,description:"List of values to plot. Currently this is the y axis, the x axis is ordinal.\nTODO: support more complex data types such as x/y points or explicit time series.",name:"data",required:!0,type:{name:"number[]"}},width:{defaultValue:null,description:"Width of the chart in pixels.",name:"width",required:!0,type:{name:"number"}},height:{defaultValue:null,description:"Height of the chart in pixels.",name:"height",required:!0,type:{name:"number"}},clipped:{defaultValue:null,description:"Indicates that the y axis should be clipped due to extreme values.\n90th percentile will be plotted.",name:"clipped",required:!1,type:{name:"boolean"}},percentile:{defaultValue:{value:"90"},description:"Percentile of the data to plot on the main graph.\nThe remainder will be plotted as overflow.",name:"percentile",required:!1,type:{name:"number"}},gradient:{defaultValue:null,description:"Indicates if a gradient fill should be used under the line to add redundant data encoding.",name:"gradient",required:!1,type:{name:"boolean"}},gradientInterpolation:{defaultValue:{value:"4"},description:"This is a multiplier to use for interpolating gradient values between data values.\nIf your data is not very dense, the gradient fill will look very blocky.\nDefaults to 4.",name:"gradientInterpolation",required:!1,type:{name:"number"}},gradientBand:{defaultValue:{value:"0"},description:"Indicates if the gradient should just be a band along the top instead of filling under the line.\nIf supplied, this should be a height for the band in pixels.",name:"gradientBand",required:!1,type:{name:"number"}},horizon:{defaultValue:null,description:"Indicates to create a horizon plot instead, by 'wrapping' the top 10% data values around the y axis.",name:"horizon",required:!1,type:{name:"boolean"}},sparkline:{defaultValue:null,description:"Render this as a sparkline, i.e., much thinner and lighter.",name:"sparkline",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../components/src/ClippedGraph/ClippedGraph.tsx#ClippedGraph"]={docgenInfo:ClippedGraph.__docgenInfo,name:"ClippedGraph",path:"../components/src/ClippedGraph/ClippedGraph.tsx#ClippedGraph"})}catch(__react_docgen_typescript_loader_error){}const ClippedGraph_stories={title:"@essex:components/ClippedGraph",component:ClippedGraph,args:{width:800,height:100,data:[1,2,3,4,3,2,3,4,3,2,3,4,5,4,5,6,5,6,5,4,3,4,3,2,25,89,30,12,3,2,3,4,3,6,7,8,7,8,7,8,7,8,9,8,9,8,7,6,7,6,5,6]}},Primary={},ClippedGradient={args:{clipped:!0,gradient:!0}},ClippedHorizon={args:{clipped:!0,horizon:!0}};Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{}",...Primary.parameters?.docs?.source}}},ClippedGradient.parameters={...ClippedGradient.parameters,docs:{...ClippedGradient.parameters?.docs,source:{originalSource:"{\n  args: {\n    clipped: true,\n    gradient: true\n  }\n}",...ClippedGradient.parameters?.docs?.source}}},ClippedHorizon.parameters={...ClippedHorizon.parameters,docs:{...ClippedHorizon.parameters?.docs,source:{originalSource:"{\n  args: {\n    clipped: true,\n    horizon: true\n  }\n}",...ClippedHorizon.parameters?.docs?.source}}}}}]);